<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Flappy Sparrow - BABU LOHAR Edition</title>
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/528/528076.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Flappy Sparrow">
    
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; touch-action: manipulation; }
        #game-container { position: relative; width: 360px; height: 580px; }
        canvas { border: 4px solid #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); background-color: #70c5ce; cursor: pointer; display: block; }
        
        /* Controls Styling */
        .top-controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; z-index: 100; }
        .control-btn { background: rgba(0,0,0,0.6); color: white; border: 2px solid #fff; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .control-btn:active { transform: scale(0.9); }
        
        #ui { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; text-shadow: 2px 2px 5px #000; z-index: 10; pointer-events: none; }
        #msg-box { background: rgba(0,0,0,0.9); padding: 25px; border-radius: 15px; border: 2px solid #fff; pointer-events: auto; text-align: center; min-width: 240px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .creator-tag { color: #f1c40f; font-weight: bold; font-size: 0.9rem; margin-top: 5px; letter-spacing: 2px; }
        
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; text-transform: uppercase; width: 100%; }
        
        .btn-easy { background: #2ecc71; color: white; }
        .btn-mid { background: #f1c40f; color: black; }
        .btn-hard { background: #e74c3c; color: white; }
        .btn-retry { background: #3498db; color: white; font-size: 1.2rem; }
        .btn-outline { background: transparent; border: 2px solid white; color: white; margin-top: 5px; }
        
        button:hover { transform: scale(1.05); filter: brightness(1.1); }
        .score-display { position: absolute; bottom: 25px; width: 100%; display: flex; justify-content: space-around; font-weight: bold; font-size: 1.2rem; pointer-events: none; }
        .hidden { display: none !important; }
        .shake { animation: shake 0.2s; }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(-5px, -5px); } 75% { transform: translate(5px, 5px); } }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="top-controls">
            <div id="muteBtn" class="control-btn" onclick="toggleMute()">üîä</div>
            <div id="menuBtn" class="control-btn" onclick="toggleMenu()">‚öôÔ∏è</div>
        </div>
        
        <div id="ui">
            <div id="msg-box">
                <div id="statusTitle" style="font-size: 1.8rem; font-weight: bold; letter-spacing: 1px;">FLAPPY SPARROW</div>
                <div class="creator-tag">BY BABU LOHAR</div>
                <div id="subText" style="margin-top: 10px; color: #ddd; font-size: 0.8rem;">Select difficulty to play</div>
                
                <div class="btn-group" id="menuOptions">
                    <button class="btn-easy" onclick="startGame('easy')">Easy Mode</button>
                    <button class="btn-mid" onclick="startGame('mid')">Middle Mode</button>
                    <button class="btn-hard" onclick="startGame('hard')">Hard Mode</button>
                </div>
                
                <div id="gameOverInfo" class="hidden">
                    <div id="finalScore" style="font-size: 2.2rem; color: #f1c40f; margin: 15px 0; font-weight: bold;"></div>
                    <div class="btn-group">
                        <button class="btn-retry" onclick="startGame()">Try Again</button>
                        <button class="btn-outline" onclick="toggleMenu()">Change Level</button>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.7rem; color: #aaa;">Dev: BABU LOHAR</div>
                </div>
            </div>

            <div class="score-display">
                <div>Score: <span id="currentScore">0</span></div>
                <div>Best: <span id="highScore">0</span></div>
            </div>
        </div>

        <canvas id="gameCanvas" width="360" height="580"></canvas>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const uiLayer = document.getElementById("ui");
        const statusTitle = document.getElementById("statusTitle");
        const subText = document.getElementById("subText");
        const menuOptions = document.getElementById("menuOptions");
        const gameOverInfo = document.getElementById("gameOverInfo");
        const finalScoreDisplay = document.getElementById("finalScore");
        const scoreEl = document.getElementById("currentScore");
        const highscoreEl = document.getElementById("highScore");
        const muteBtn = document.getElementById("muteBtn");

        // --- Audio Setup ---
        const bgMusic = new Audio('https://assets.mixkit.co/music/preview/mixkit-sun-and-clouds-585.mp3');
        bgMusic.loop = true;
        bgMusic.volume = 0.3;

        const jumpSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2044/2044-preview.mp3');
        const scoreSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3');
        const crashSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2056/2056-preview.mp3');
        
        let isMuted = false;

        function toggleMute() {
            isMuted = !isMuted;
            bgMusic.muted = isMuted;
            jumpSound.muted = isMuted;
            scoreSound.muted = isMuted;
            crashSound.muted = isMuted;
            muteBtn.innerText = isMuted ? "üîá" : "üîä";
        }

        let birdY = 250, birdX = 50, velocity = 0;
        let score = 0, pipes = [], clouds = [], gameRunning = false, frames = 0;
        let currentLevel = 'easy';
        
        const levels = {
            easy: { gravity: 0.17, jump: -4.2, speed: 1.6, gap: 190, spawn: 130 },
            mid:  { gravity: 0.23, jump: -5.2, speed: 2.4, gap: 160, spawn: 100 },
            hard: { gravity: 0.29, jump: -5.8, speed: 3.3, gap: 140, spawn: 80 }
        };

        let currentSettings = levels.easy;
        let highScore = localStorage.getItem("flappyHighScore") || 0;
        highscoreEl.innerText = highScore;

        for(let i=0; i<5; i++) clouds.push({x: Math.random()*canvas.width, y: Math.random()*200, speed: 0.2+Math.random()*0.4, size: 25+Math.random()*20});

        function startGame(lvl) {
            if (lvl) {
                currentLevel = lvl;
                currentSettings = levels[lvl];
            }
            if(!isMuted) bgMusic.play().catch(()=>{});
            
            birdY = 250; velocity = 0; score = 0; pipes = []; frames = 0;
            scoreEl.innerText = "0";
            gameRunning = true;
            uiLayer.classList.add("hidden");
            canvas.classList.remove("shake");
        }

        function toggleMenu() {
            gameRunning = false;
            statusTitle.innerText = "GAME MENU";
            subText.innerText = "Choose your level";
            menuOptions.classList.remove("hidden");
            gameOverInfo.classList.add("hidden");
            uiLayer.classList.remove("hidden");
        }

        function handleInput(e) {
            if (e.target.closest('.top-controls') || e.target.tagName === 'BUTTON') return;
            if (e.type === "touchstart") e.preventDefault();
            
            if (gameRunning) {
                velocity = currentSettings.jump;
                if(!isMuted) {
                    jumpSound.currentTime = 0;
                    jumpSound.play().catch(()=>{});
                }
            }
        }

        canvas.addEventListener("mousedown", handleInput);
        canvas.addEventListener("touchstart", handleInput, {passive: false});
        window.addEventListener("keydown", (e) => { if(e.code === "Space") handleInput(e); });

        function drawBird() {
            ctx.save();
            ctx.translate(birdX + 15, birdY + 15);
            ctx.rotate(Math.min(Math.PI/4, Math.max(-Math.PI/4, velocity/10)));
            ctx.fillStyle = "#8B4513"; ctx.beginPath(); ctx.ellipse(0, 0, 18, 13, 0, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#A0522D"; ctx.beginPath(); ctx.ellipse(-5, 2, 10, 6, velocity/10, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#8B4513"; ctx.beginPath(); ctx.arc(12, -5, 10, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(15, -7, 4, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(16, -7, 2, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = "#D2691E"; ctx.beginPath(); ctx.moveTo(22, -5); ctx.lineTo(30, -2); ctx.lineTo(22, 1); ctx.fill();
            ctx.restore();
        }

        function drawPipes() {
            for (let p of pipes) {
                let pipeGrad = ctx.createLinearGradient(p.x, 0, p.x + 50, 0);
                pipeGrad.addColorStop(0, "#2c3e50");
                pipeGrad.addColorStop(0.5, "#95a5a6");
                pipeGrad.addColorStop(1, "#2c3e50");
                ctx.fillStyle = pipeGrad;
                ctx.fillRect(p.x, 0, 50, p.top);
                ctx.fillRect(p.x, p.top + currentSettings.gap, 50, canvas.height);
                ctx.fillStyle = "#34495e";
                ctx.fillRect(p.x - 5, p.top - 25, 60, 25);
                ctx.fillRect(p.x - 5, p.top + currentSettings.gap, 60, 25);
            }
        }

        function update() {
            clouds.forEach(c => { c.x -= c.speed; if(c.x + 100 < 0) c.x = canvas.width + 50; });
            if (!gameRunning) return;
            frames++;
            velocity += currentSettings.gravity;
            birdY += velocity;

            if (frames % currentSettings.spawn === 0) {
                const h = Math.floor(Math.random() * (canvas.height - currentSettings.gap - 120)) + 60;
                pipes.push({ x: canvas.width, top: h });
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= currentSettings.speed;
                if (birdX + 25 > pipes[i].x && birdX + 5 < pipes[i].x + 50) {
                    if (birdY + 5 < pipes[i].top || birdY + 25 > pipes[i].top + currentSettings.gap) gameOver();
                }
                if (pipes[i].x + currentSettings.speed >= birdX && pipes[i].x < birdX) {
                    score++; 
                    scoreEl.innerText = score;
                    if(!isMuted) {
                        scoreSound.currentTime = 0;
                        scoreSound.play().catch(()=>{});
                    }
                }
                if (pipes[i].x + 50 < 0) pipes.splice(i, 1);
            }
            if (birdY > canvas.height - 20 || birdY < 0) gameOver();
        }

        function gameOver() {
            gameRunning = false;
            canvas.classList.add("shake");
            if(!isMuted) crashSound.play().catch(()=>{});
            bgMusic.pause();
            if (score > highScore) {
                highScore = score;
                localStorage.setItem("flappyHighScore", highScore);
                highscoreEl.innerText = highScore;
            }
            statusTitle.innerText = "GAME OVER";
            subText.innerText = "Don't give up sparrow!";
            finalScoreDisplay.innerText = "SCORE: " + score;
            menuOptions.classList.add("hidden");
            gameOverInfo.classList.remove("hidden");
            uiLayer.classList.remove("hidden");
        }

        function draw() {
            let g = ctx.createLinearGradient(0, 0, 0, canvas.height);
            g.addColorStop(0, "#70c5ce"); g.addColorStop(1, "#a4ebf3");
            ctx.fillStyle = g; ctx.fillRect(0, 0, canvas.width, canvas.height);
            clouds.forEach(c => {
                ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
                ctx.beginPath(); ctx.arc(c.x, c.y, c.size, 0, Math.PI * 2); ctx.arc(c.x + c.size * 0.5, c.y - c.size * 0.3, c.size * 0.8, 0, Math.PI * 2); ctx.fill();
            });
            drawPipes();
            ctx.fillStyle = "#ded895"; ctx.fillRect(0, canvas.height-15, canvas.width, 15);
            drawBird();
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }
        loop();
    </script>
</body>
</html>